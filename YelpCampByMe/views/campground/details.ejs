<%-include('../partials/bootstrap.ejs') %>

  <body>
    <%-include('../layouts/navbar')%>
    <%-include('../partials/flash.ejs') %>
    

    <div class="container-fluid">

      <div class="row">
        <div class="col">

    <div id="carouselExampleControls" class="carousel slide" data-bs-ride="carousel">
  
      <div class="carousel-inner">
<% campground.images.forEach((img,i) =>{  %>
    <div class="carousel-item <%= i === 0 ? 'active' : '' %> ">
      <img src="<%=img.url%>" class="d-block w-25 h-25" alt="">
    </div>
    <% }) %>
  </div>
  <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Previous</span>
  </button>
  <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Next</span>
  </button>
</div>
    
     <h1><%=campground.name%></h1>
    <h2><%=campground.city%></h2>
    <h3><%=campground.price%></h3>
    <p>By <b><%=campground.author.username %></b></p>




    <% if(currentUser && campground.author._id.equals(currentUser._id)) {%>
    <form
      action="/campgrounds/delete/<%=campground._id%>?_method=delete"
      method="post"
    >
      <button>Delete</button>
    </form>
    <a href="/campgrounds/edit/<%=campground._id%>">Edit</a>
    <% } %>
    <a href="/campgrounds">All Campgrounds</a>

    
    <% if(currentUser){ %>
    <form
      action="/campgrounds/<%=campground._id%>/review"
      method="post"
      novalidate
      class="validate-form"
    >
      <div>
        <label for="rating" class="form-label">Rate</label>
        <input class="form-range" type="range" min="1" max="5" name="rating" id="rating" required />
      </div>
      <div>
        <label class="form-label" for="review">Review</label>
        <textarea
          class="form-control"
          name="review"
          id="review"
          cols="30"
          rows="3"
          required
        ></textarea>
      </div>
      <button class="btn btn-success">submit</button>
      
    </form>
    <% } %>

    <div>
      <% for(review of campground.reviews) {%>
        <p>Rating : <%=review.rating%></p>
        <p>Review : <%=review.review%></p>
        <p>by <b><%=review.author.username%></b></p>
        <% if(currentUser && review.author._id.equals(currentUser.id)){ %>
        <form action="/campgrounds/<%=campground._id%>/review/<%=review._id%>?_method=delete" method="post">
          <button>Delete</button>
        </form>
        <% } %>
        <% } %>
        </div>


    </div>

    <div class="col">
       <div id="map"></div>
    </div>
    

    <%-include('../partials/JavaScript.ejs') %>
    <%-include('../partials/validateForm.ejs') %>



    </div>
    </div>
  </body>
 
</html>


  <script>
    const campground = <%-JSON.stringify(campground)%>;
    const map_api_key = "<%=(process.env.MAPTILER_CLIENT_API_KEY)%>"
  </script>
   
    <script>
   maptilersdk.config.apiKey = map_api_key;
      const map = new maptilersdk.Map({
        container: 'map', // container's id or the HTML element to render the map
        style: maptilersdk.MapStyle.STREETS,
        center: campground.geometry.coordinates, // starting position [lng, lat]
        zoom: 10, // starting zoom
    });
    const marker = new maptilersdk.Marker()
    .setLngLat(campground.geometry.coordinates)
    .addTo(map);
  </script>